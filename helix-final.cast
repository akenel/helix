{"version": 2, "width": 92, "height": 23, "timestamp": 1754516842, "env": {"SHELL": "/bin/bash", "TERM": "xterm-256color"}}
[0.099384, "o", "🔧 Helix Bootstrap Directory: /home/angel/helix\r\n"]
[0.180831, "o", "\u001b[H\u001b[2J\u001b[3J"]
[0.288297, "o", "\u001b[1;35m\r\n"]
[0.291722, "o", "      ██   ██╗██████╗██╗    ██╗██╗  ██╗       \r\n      ██╔══██║██╔═══╝██║    ██║╚██╗██╔╝       \r\n      ███████║████╗  ██║    ██║ ╚███╔╝       \r\n      ██╔══██║██╔═╝  ██║    ██║ ██╔██╗     \r\n      ██║  ██║██████╗██████╗██║██╔╝ ██╗     \r\n      ╚═╝  ╚═╝╚═════╝╚═════╝╚═╝╚═╝  ╚═╝ ©   \r\n─────────────────────────────────────────────\r\n"]
[0.292128, "o", "\u001b[1;36m\r\n🎛️  H E L I X \u001b[1;33mv0.0.0-dev\u001b[1;36m  🐳\r\n \u001b[1;32m• Deployment Orchestrator •\u001b[1;36m\r\n"]
[0.292431, "o", "─────────────────────────────────────────────\r\n🕒  2025-08-06 23:47:23 CEST • 🧬 Git:690cd6b\r\n\u001b[0m\r\n\u001b[0;36m🔧 Loading environment...\u001b[0m\r\n"]
[0.300944, "o", "🔧 Loading Helix Environment from: /home/angel/helix/bootstrap_env_loader.sh\r\n"]
[3.513654, "o", "\r\n📡 System Snapshot Loaded:\r\n🔹 IP Address     : 84.241.111.26\r\n🔹 Location       : Beckenried, Nidwalden, CH\r\n"]
[3.51678, "o", "🔹 Current Date   : Wed Aug  6 23:47:26 CEST 2025\r\n"]
[3.519625, "o", "🔹 Current Time   : 23:47:26\r\n🔹 Temperature    : 19°C\r\n🔹 Wind Speed     : 4 km/h\r\n🔹 Docker Version : Docker version 28.2.2, build e6534b4\r\n📦 Root Directory : /home/angel\r\n"]
[3.519976, "o", "🔹 Linux Info     : \r\nLinux 6.6.87.2-microsoft-standard-WSL2 #1 SMP PREEMPT_DYNAMIC Thu Jun  5 18:30:46 UTC 2025 x86_64 GNU/Linux\r\n🧠 Completed bootstrap_env_loader.sh\r\n🐳\r\n✨ Grand Helix Platform Environment Loaded 🚀\r\n\r\n🔑 Keycloak Deployment Phase  \r\n"]
[3.520254, "o", "\u001b[0;32m✅ whiptail is installed. Launching...\u001b[0m\r\n"]
[3.533556, "o", "\u001b[?1049h\u001b[22;0;0t\u001b[1;23r\u001b[4l\u001b[?25l\u001b(B\u001b[m\u001b[37m\u001b[40m\u001b[1;23r\u001b[H\u001b[2J\u001b[1;1H\u001b[97m\u001b[45m\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\u001b[1;1H"]
[3.535697, "o", "\u001b[1;7H\u001b[30m\u001b[47m│ Choose an action:                                                            │\u001b[97m\u001b[40m \u001b[2;7H\u001b[30m\u001b[47m│                                                                              │\u001b[97m\u001b[40m \u001b[3;7H\u001b[30m\u001b[47m│                  \u001b[37m\u001b[41m1 🚀 Run All Core Steps                  \u001b[30m\u001b[47m                   │\u001b[97m\u001b[40m \u001b[4;7H\u001b[30m\u001b[47m│                  2 📊 Create Cluster & Registry                              │\u001b[97m\u001b[40m \u001b[5;7H\u001b[30m\u001b[47m│                  3 🔐 Generate TLS Certs                                     │\u001b[97m\u001b[40m \u001b[6;7H\u001b[30m\u001b[47m│                  4 🔑 Bootstrap Vault & Unseal                               │\u001b[97m\u001b[40m \u001b[7;7H\u001b[30m\u001b[47m│                  5 🧠 Deploy Keycloak & Postgres                             │\u001b[97m\u001b[40m \u001b[8;7H\u001b[30m\u001b[47m│                  6 ✅ Post Keycloak Initialization Realm                     │\u001b[97m\u001b[40m \u001b[9;7H\u001b[30m\u001b[47m│                  7 🔗 Configure Vault and Keycloak OIDC                      │\u001b[97m\u001b[40m \u001b[10;7H\u001b[30m\u001b[47m│                  9 🔧 Plugin Manager                                         │\u001b[97m\u001b[40m \u001b[11;7H\u001b[30m\u001b[47m│                  A 🔥 Before vs After: The DevOps Mic Drop                   │\u001b[97m\u001b[40m \u001b[12;7H\u001b[30m\u001b[47m│                  Q ❌ Quit                                                   │\u001b[97m\u001b[40m \u001b[13;7H\u001b[30m\u001b[47m│                                                                              │\u001b[97m\u001b[40m \u001b[14;7H\u001b[30m\u001b[47m│                                                                              │\u001b[97m\u001b[40m \u001b[15;7H\u001b[30m\u001b[47m│                                                                              │\u001b[97m\u001b[40m \u001b[16;7H\u001b[30m\u001b[47m│                                                                              │\u001b[97m\u001b[40m \u001b[17;7H\u001b[30m\u001b[47m│                                                                              │\u001b[97m\u001b[40m \u001b[18;7H\u001b[30m\u001b[47m│                                                                              │\u001b[97m\u001b[40m \u001b[19;7H\u001b[30m\u001b[47m│                                                                              │\u001b[97m\u001b[40m \u001b[20;7H\u001b[30m\u001b[47m│                                                                              │\u001b[97m\u001b[40m \u001b[21;7H\u001b[30m\u001b[47m│                                                                              │\u001b[97m\u001b[40m \u001b[22;7H\u001b[30m\u001b[47m│                     <Ok>                         <Cancel>                    │\u001b[97m\u001b[40m \u001b[23;7H\u001b[30m\u001b[47m│                                                                              │\u001b[97m\u001b[40m \u001b[3;26H"]
[18.542745, "o", "\u001b[30m\u001b[47m1 🚀 Run All Core Steps                  \u001b[4;26H\u001b[37m\u001b[41m2 📊 Create Cluster & Registry           \u001b[4;26H"]
[18.861584, "o", "\u001b[30m\u001b[47m2 📊 Create Cluster & Registry           \u001b[5;26H\u001b[37m\u001b[41m3 🔐 Generate TLS Certs                  \u001b[5;26H"]
[19.092013, "o", "\u001b[30m\u001b[47m3 🔐 Generate TLS Certs                  \u001b[6;26H\u001b[37m\u001b[41m4 🔑 Bootstrap Vault & Unseal            \u001b[6;26H"]
[19.309069, "o", "\u001b[30m\u001b[47m4 🔑 Bootstrap Vault & Unseal            \u001b[7;26H\u001b[37m\u001b[41m5 🧠 Deploy Keycloak & Postgres          \u001b[7;26H"]
[19.531719, "o", "\u001b[30m\u001b[47m5 🧠 Deploy Keycloak & Postgres          \u001b[8;26H\u001b[37m\u001b[41m6 ✅ Post Keycloak Initialization Realm  \u001b[8;26H"]
[19.749217, "o", "\u001b[30m\u001b[47m6 ✅ Post Keycloak Initialization Realm  \u001b[9;26H\u001b[37m\u001b[41m7 🔗 Configure Vault and Keycloak OIDC   \u001b[9;26H"]
[20.479797, "o", "\u001b[?12l\u001b[?25h\u001b[23;1H"]
[20.480326, "o", "\u001b[40m\u001b(B\u001b[m\u001b[39;49m\r\u001b[K\r\u001b[?1049l\u001b[23;0;0t"]
[20.484431, "o", "\r\n🔹 \u001b[0;33mRunning: Configure Vault and Keycloak OIDC\u001b[0m\r\n"]
[20.493541, "o", "📋 Loading environment...\r\n"]
[20.493752, "o", "🔑 Extracting Vault Root Token and Unseal Key from secrets file...\r\n"]
[20.542382, "o", "🔐 VAULT_ADDR=http://127.0.0.1:8200\r\n🔑 Using Vault ROOT Token: hvs.UdaY9oUZzZX********\r\n🗝️ Using Vault Unseal Key: rnOTMxewkn********\r\n🔎 Locating Vault pod...\r\n"]
[20.930062, "o", "📦 Vault pod found: vault-helix-0\r\n🔓 Checking if Vault is unsealed and accessible...\r\n⏳ Checking Keycloak readiness...\r\n"]
[21.336164, "o", "⚠️  Keycloak namespace 'keycloak' not found, proceeding anyway...\r\n🌐 Testing Keycloak discovery endpoint accessibility...\r\n"]
[29.537085, "o", "If you don't see a command prompt, try pressing enter.\r\n"]
[32.884597, "o", "pod default/test-keycloak-connectivity terminated (Error)\r\n"]
[32.890921, "o", "⚠️  Keycloak discovery endpoint test failed (may be normal if using internal DNS)\r\n"]
[32.891585, "o", "🔗 Keycloak Discovery URL: https://keycloak.helix/realms/helix3d\r\n🔗 OIDC Client ID: vault-integration\r\n🔗 OIDC Client Secret: vault-client-secret\r\n🔗 Role Name: helix3d-role\r\n\r\n🔍 Verifying token permissions...\r\n"]
[34.773942, "o", "🔐 Token capabilities for sys/auth/oidc: root\r\n⚙️ Enabling OIDC auth method (if not already enabled)...\r\n"]
[36.496299, "o", "✅ OIDC already enabled\r\n🔧 Configuring Vault to trust Keycloak (Realm: helix3d)...\r\n"]
[37.40629, "o", "\u001b[1;39m{\r\n  \u001b[0m\u001b[1;34m\"uuid\"\u001b[0m\u001b[1;39m: \u001b[0m\u001b[0;32m\"d73de691-d0f3-0188-abeb-170351258d0d\"\u001b[0m\u001b[1;39m,\r\n  \u001b[0m\u001b[1;34m\"type\"\u001b[0m\u001b[1;39m: \u001b[0m\u001b[0;32m\"oidc\"\u001b[0m\u001b[1;39m,\r\n  \u001b[0m\u001b[1;34m\"description\"\u001b[0m\u001b[1;39m: \u001b[0m\u001b[0;32m\"\"\u001b[0m\u001b[1;39m,\r\n  \u001b[0m\u001b[1;34m\"accessor\"\u001b[0m\u001b[1;39m: \u001b[0m\u001b[0;32m\"auth_oidc_01b3d60b\"\u001b[0m\u001b[1;39m,\r\n  \u001b[0m\u001b[1;34m\"config\"\u001b[0m\u001b[1;39m: \u001b[0m\u001b[1;39m{\r\n    \u001b[0m\u001b[1;34m\"default_lease_ttl\"\u001b[0m\u001b[1;39m: \u001b[0m\u001b[0;39m0\u001b[0m\u001b[1;39m,\r\n    \u001b[0m\u001b[1;34m\"max_lease_ttl\"\u001b[0m\u001b[1;39m: \u001b[0m\u001b[0;39m0\u001b[0m\u001b[1;39m,\r\n    \u001b[0m\u001b[1;34m\"force_no_cache\"\u001b[0m\u001b[1;39m: \u001b[0m\u001b[0;39mfalse\u001b[0m\u001b[1;39m,\r\n    \u001b[0m\u001b[1;34m\"token_type\"\u001b[0m\u001b[1;39m: \u001b[0m\u001b[0;32m\"default-service\"\u001b[0m\u001b[1;39m\r\n  \u001b[1;39m}\u001b[0m\u001b[1;39m,\r\n  \u001b[0m\u001b[1;34m\"options\"\u001b[0m\u001b[1;39m: \u001b[0m\u001b[0;90mnull\u001b[0m\u001b[1;39m,\r\n  \u001b[0m\u001b[1;34m\"local\"\u001b[0m\u001b[1;39m: \u001b[0m\u001b[0;39mfalse\u001b[0m\u001b[1;39m,\r\n  \u001b[0m\u001b[1;34m\"seal_wrap\"\u001b[0m\u001b[1;39m: \u001b[0m\u001b[0;39mfalse\u001b[0m\u001b[1;39m,\r\n  \u001b[0m\u001b[1;34m\"external_entropy_access\"\u001b[0m\u001b[1;39m: \u001b[0m\u001b[0;39mfalse\u001b[0m\u001b[1;39m,\r\n  \u001b[0m\u001b[1;34m\"plugin_version\"\u001b[0m\u001b[1;39m: \u001b[0m\u001b[0;32m\"\"\u001b[0m\u001b[1;39m,\r\n  \u001b[0m\u001b[1;34m\"running_plugin_version\"\u001b[0m\u001b[1;39m: \u001b[0m\u001b[0;32m\"v1.19.0+builtin.vault\"\u001b[0m\u001b[1;39m,\r\n  \u001b[0m\u001b[1;34m\"running_sha256\"\u001b[0m\u001b[1;39m: \u001b[0m\u001b[0;32m\"\"\u001b[0m\u001b[1;39m,\r\n  \u001b[0m\u001b[1;34m\"deprecation_status\"\u001b[0m\u001b[1;39m: \u001b[0m\u001b[0;32m\"supported\"\u001b[0m\u001b[1;39m\r\n\u001b[1;39m}\u001b[0m\r\n"]
[37.458499, "o", "✅ OIDC configuration written successfully\r\n📋 OIDC Role 'helix3d-role':\r\n"]
[41.180647, "o", "Key                        Value\r\n---                        -----\r\nallowed_redirect_uris      [https://vault.helix/ui/vault/auth/oidc/oidc/callback https://vault.helix/ui/vault/auth/oidc/oidc/callback/]\r\nbound_audiences            [vault-integration]\r\nbound_claims               <nil>\r\nbound_claims_type          string\r\nbound_subject              n/a\r\nclaim_mappings             <nil>\r\nclock_skew_leeway          0\r\nexpiration_leeway          0\r\ngroups_claim               n/a\r\nmax_age                    0\r\n"]
[41.181173, "o", "max_ttl                    24h\r\nnot_before_leeway          0\r\noidc_scopes                <nil>\r\npolicies                   [default]\r\nrole_type                  oidc\r\ntoken_bound_cidrs          []\r\ntoken_explicit_max_ttl     0s\r\ntoken_max_ttl              24h\r\ntoken_no_default_policy    false\r\ntoken_num_uses             0\r\ntoken_period               0s\r\ntoken_policies             [default]\r\ntoken_ttl                  1h\r\ntoken_type                 default\r\nttl                        1h\r\nuser_claim                 preferred_username\r\nuser_claim_json_pointer    false\r\nverbose_oidc_logging       false\r\n"]
[41.206175, "o", "🔒 Configuring Vault TLS Certificate with mkcert issuer...\r\n"]
[41.206415, "o", "🔒 Configuring Vault TLS Certificate with mkcert issuer...\r\n🧹 Cleaning up old CertificateRequests, Secrets, and Certificates...\r\n"]
[41.793705, "o", "certificaterequest.cert-manager.io \"vault-tls-1\" deleted\r\n"]
[41.808747, "o", "certificaterequest.cert-manager.io \"vault-tls-2\" deleted\r\n"]
[42.402711, "o", "secret \"vault-tls\" deleted\r\n"]
[42.908555, "o", "certificate.cert-manager.io \"vault-tls\" deleted\r\n"]
[43.417765, "o", "ingress.networking.k8s.io \"vault-ingress\" deleted\r\n"]
[45.056761, "o", "clusterissuer.cert-manager.io/mkcert-cluster-issuer unchanged\r\n"]
[45.06382, "o", "Warning: resource certificates/vault-tls is missing the kubectl.kubernetes.io/last-applied-configuration annotation which is required by kubectl apply. kubectl apply should only be used on resources created declaratively by either kubectl create --save-config or kubectl apply. The missing annotation will be patched automatically.\r\n"]
[45.096207, "o", "certificate.cert-manager.io/vault-tls configured\r\n"]
[45.138904, "o", "✅ Certificate and ClusterIssuer applied.\r\n⏳ Waiting for TLS certificate 'vault-tls' to be issued by cert-manager...\r\n"]
[46.632212, "o", "🔄 Waiting... (0/120s)\r\n"]
[52.263022, "o", "🔄 Waiting... (5/120s)\r\n"]
[57.970759, "o", "🔄 Waiting... (10/120s)\r\n"]
[64.177937, "o", "🔄 Waiting... (15/120s)\r\n"]
[69.968331, "o", "🔄 Waiting... (20/120s)\r\n"]
[75.541286, "o", "🔄 Waiting... (25/120s)\r\n"]
[81.105546, "o", "🔄 Waiting... (30/120s)\r\n"]
[87.101729, "o", "🔄 Waiting... (35/120s)\r\n"]
[92.690985, "o", "🔄 Waiting... (40/120s)\r\n"]
[98.50145, "o", "🔄 Waiting... (45/120s)\r\n"]
[105.7286, "o", "🔄 Waiting... (50/120s)\r\n"]
[111.688779, "o", "🔄 Waiting... (55/120s)\r\n"]
[117.441296, "o", "🔄 Waiting... (60/120s)\r\n"]
[122.948096, "o", "🔄 Waiting... (65/120s)\r\n"]
[128.338985, "o", "🔄 Waiting... (70/120s)\r\n"]
[135.029587, "o", "🔄 Waiting... (75/120s)\r\n"]
[140.615326, "o", "🔄 Waiting... (80/120s)\r\n"]
[146.714093, "o", "🔄 Waiting... (85/120s)\r\n"]
[152.347689, "o", "🔄 Waiting... (90/120s)\r\n"]
[159.621126, "o", "🔄 Waiting... (95/120s)\r\n"]
[165.158427, "o", "🔄 Waiting... (100/120s)\r\n"]
[170.662782, "o", "🔄 Waiting... (105/120s)\r\n"]
[176.233021, "o", "🔄 Waiting... (110/120s)\r\n"]
[181.730554, "o", "🔄 Waiting... (115/120s)\r\n"]
[187.455906, "o", "❌ Timeout waiting for TLS certificate to be ready.\r\n"]
[190.350175, "o", "Name:         vault-tls\r\nNamespace:    vault\r\nLabels:       app.kubernetes.io/instance=vault-helix\r\n              app.kubernetes.io/managed-by=Helm\r\n              app.kubernetes.io/name=vault\r\n              helm.sh/chart=vault-0.30.1\r\nAnnotations:  <none>\r\nAPI Version:  cert-manager.io/v1\r\nKind:         Certificate\r\nMetadata:\r\n  Creation Timestamp:  2025-08-06T21:48:05Z\r\n  Generation:          3\r\n  Owner References:\r\n    API Version:           networking.k8s.io/v1\r\n    Block Owner Deletion:  true\r\n    Controller:            true\r\n    Kind:                  Ingress\r\n    Name:                  vault-helix\r\n    UID:                   c8c400d2-664b-4b67-9b5e-a91f553ec355\r\n  Resource Version:        7722\r\n  UID:                     5dc773e4-05d5-4e32-bc78-a8de4a2d8501\r\nSpec:\r\n  Dns Names:\r\n    vault.helix\r\n  Issuer Ref:\r\n    Group:      cert-manager.io\r\n    Kind:       ClusterIssuer\r\n    Name:       mkcert-cluster-issuer\r\n  Secret Name:  vault-tls\r\n  Usages:\r\n    digital signature\r\n    key encipherment\r\nStatus:\r\n  Conditions:\r\n    Last Transition Time:        2025-08-06T21:48:05Z\r\n    Message:                     Issuing certificate as Secret does not exist\r\n    Observed Generation:         1\r\n    Reason:                      DoesNotExist\r\n    Status:                      True\r\n    Type:                        Issuing\r\n    Last Transition Time:        2025-08-06T21:48:05Z\r\n    Message:                     Issuing certificate as Secret does not exist\r\n    Observed Generation:         3\r\n    Reason:                      DoesNotExist\r\n    Status:                      False\r\n    Type:                        Ready\r\n  Next Private Key Secret Name:  vault-tls-9c2wm\r\nEvents:\r\n  Type     Reason         Age                    From                                       Message\r\n  ----     ------         ----                   ----                                       -------\r\n  Normal   Issuing        2m28s                  cert-manager-certificates-trigger          Issuing certificate as Secret does not exist\r\n  Normal   Generated      2m27s                  cert-manager-certificates-key-manager      Stored new private key in temporary Secret resource \"vault-tls-9c2wm\"\r\n  Normal   Requested      2m25s (x3 over 2m27s)  cert-manager-certificates-request-manager  Created new CertificateRequest resource \"vault-tls-1\"\r\n  Warning  RequestFailed  2m25s                  cert-manager-certificates-request-manager  Failed to create CertificateRequest: certificaterequests.cert-manager.io \"vault-tls-1\" already exists\r\n"]
[190.35738, "o", "\u001b[0;31m❌ Failed: Configure Vault and Keycloak OIDC\u001b[0m\r\n"]
