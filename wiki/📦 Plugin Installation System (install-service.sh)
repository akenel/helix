## ğŸ“¦ Plugin Installation System (`install-service.sh`)

The **Helix Plugin Manager** is a dynamic, declarative interface to install, validate, upgrade, and remove services from your Kubernetes cluster via Helm charts. It operates through a modular shell architecture, offering flexibility, validation, and clean lifecycle management.

---

### ğŸš€ Features

* ğŸ§  **Plugin-aware CLI**: Run actions per plugin using `--plug <name> --install`, `--validate-only`, `--uninstall`, etc.
* ğŸ§¾ **Declarative YAML Structure**: Every plugin includes a `values.yaml` that drives its Helm configuration.
* ğŸ” **Secrets Integration**: Supports `vault:` references in YAML for dynamic secret resolution.
* ğŸ“š **Service Catalog**: Controlled through `services.yaml` for central service metadata and control.
* ğŸ” **Dry-run Validation**: Helm dry-run execution (`--validate-only`) ensures values are valid before real deployments.
* ğŸ§¼ **Clean Lifecycle**: Easily uninstall services via CLI without residual resource conflicts.
* ğŸ§ª **Plugin Testing**: Lifecycle test script for continuous integration testing of deployments.
* ğŸ“œ **Whiptail UI**: Optional TUI submenu for plugin operations from the main orchestrator.

---

### ğŸ—‚ï¸ Folder Structure

```plaintext
bootstrap/
â”œâ”€â”€ addon-configs/
â”‚   â”œâ”€â”€ <plugin>/
â”‚   â”‚   â””â”€â”€ <plugin>-values.yaml       # Per-plugin Helm values
â”‚   â”œâ”€â”€ shared/                        # Shared value templates
â”‚   â”œâ”€â”€ helpers/                       # Modular shell helpers (display, deploy, parse, validate)
â”‚   â”œâ”€â”€ services.yaml                  # Plugin registry and descriptions
â”‚   â””â”€â”€ install-service.sh             # Main controller script
```

---

### ğŸ› ï¸ Usage

```bash
# Validate n8n without deploying
./bootstrap/addon-configs/install-service.sh --plug n8n --validate-only

# Install portainer
./bootstrap/addon-configs/install-service.sh --plug portainer --install

# Uninstall a plugin
./bootstrap/addon-configs/install-service.sh --plug n8n --uninstall

# Edit plugin's values file
./bootstrap/addon-configs/install-service.sh --plug portainer --edit

# Launch interactive menu
./bootstrap/deployment-phases/run_plugins_menu.sh
```

---

### ğŸ“‹ Plugin Entry Format (in `services.yaml`)

```yaml
plugins:
  - name: n8n
    description: Low-code workflow automation
    enabled: true
    values_file: "n8n/n8n-values.yaml"
    helm_install_cmd: "helm install my-n8n n8n/n8n"
    namespace: default
```

---

### ğŸ“ˆ Future Improvements

1. ğŸ§ª Enhanced validation (`helm-schema`, `yamllint`)
2. ğŸ“¦ Plugin version locking & history tracking
3. ğŸ’¬ Internationalization support for menus
4. ğŸ” Dependency resolution between services
5. ğŸ§° Integrated secret rendering from Vault during `install-service.sh`

---

### ğŸ›‘ Manual Cleanup Tip

Should a plugin crash or hang:

```bash
# Uninstall Helm chart
helm uninstall my-n8n -n default

# Delete stuck pods (if needed)
kubectl delete pod <pod-name> -n <namespace>

# Reset a namespace (use carefully!)
kubectl delete ns <namespace>
```

---

### â¤ï¸ A Word From the Creator

> *"What weâ€™ve built is a private cloud suite rivaling commercial stacks at a fraction of the complexity and none of the lock-in. We believe in local-first orchestration. Helix is a statement â€” of independence, clarity, and power."* â€” Angel & Sherlock

---

## ğŸ§­ Next Steps (Post-Commit)

Hereâ€™s a roadmap suggestion for your **next Git branch** (`feature/plugin-menu-refactor` perhaps):

### ğŸ—ºï¸ Immediate Tasks:

* [ ] Wire in `run_plugins_menu.sh` to Whiptail menu option **B**
* [ ] Add Helm chart schema validation (`helm-schema`)
* [ ] Auto-detect and inject `service.name` into `values.yaml` when missing
* [ ] Improve log rotation / cleanup for `/logs/`

### ğŸŒ± Growth Ideas:

* [ ] Plugin dependency graph (e.g., n8n requires Keycloak)
* [ ] JSON schema UI for customizing plugin YAMLs
* [ ] GitHub Actions workflow for testing `test-plugin-lifecycle.sh`

---

### ğŸ”— Suggested Section Header for README

Append this new section to your current README.md under:

```markdown
## âš™ï¸ Advanced Deployment: The Helix Plugin Installer
```

This will neatly separate it from core cluster bootstrap and emphasize its power.

---

