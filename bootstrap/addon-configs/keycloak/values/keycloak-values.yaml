replicaCount: 1

image:
  repository: quay.io/keycloak/keycloak
  tag: "24.0.3"
  pullPolicy: IfNotPresent

command:
  - "/opt/keycloak/bin/kc.sh"
args:
  - "start-dev"
  - "--import-realm"

postgresql:
  enabled: false

extraEnv: |
  - name: DB_VENDOR
    value: postgres
  - name: DB_ADDR
    value: postgres.identity.svc.cluster.local
  - name: DB_PORT
    value: "5432"
  - name: DB_DATABASE
    value: keycloakdb
  - name: DB_USER_FILE
    value: /secrets/db-creds/user
  - name: DB_PASSWORD_FILE
    value: /secrets/db-creds/password
  - name: KEYCLOAK_ADMIN
    value: admin
  - name: KEYCLOAK_ADMIN_PASSWORD
    value: admin
  - name: KC_PROXY
    value: edge
  - name: KC_HOSTNAME
    value: keycloak.helix  
  - name: KC_HOSTNAME_STRICT
    value: "false"

extraVolumeMounts: |
  - name: db-creds
    mountPath: /secrets/db-creds
    readOnly: true

extraVolumes: |
  - name: db-creds
    secret:
      secretName: keycloak-db-creds

ingress:
  enabled: true
  ingressClassName: "traefik"
  annotations:
    cert-manager.io/cluster-issuer: "mkcert-ca-issuer"
    traefik.ingress.kubernetes.io/router.entrypoints: "websecure"
    traefik.ingress.kubernetes.io/router.tls: "true"
  rules:
    - host: keycloak.helix
      paths:
        - path: /
          pathType: Prefix
  tls:
    - hosts:
        - keycloak.helix
      secretName: keycloak-helix-tls

resources:
  requests:
    memory: "1Gi"
    cpu: "500m"
  limits:
    memory: "2Gi"
    cpu: "1"

startupProbe: |
  httpGet:
    path: /
    port: 8080
  initialDelaySeconds: 600
  timeoutSeconds: 5
  periodSeconds: 10
  failureThreshold: 12

readinessProbe: |
  httpGet:
    path: /
    port: 8080
  initialDelaySeconds: 600
  timeoutSeconds: 5
  periodSeconds: 10
  failureThreshold: 5

livenessProbe: |
  httpGet:
    path: /
    port: 8080
  initialDelaySeconds: 600
  timeoutSeconds: 5
  periodSeconds: 10
  failureThreshold: 5
